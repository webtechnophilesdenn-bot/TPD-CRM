<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Case Study - Admin Panel</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; color: #333; line-height: 1.6; }
        
        /* Header */
        .admin-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .header-title { font-size: 1.75rem; font-weight: 600; display: flex; align-items: center; gap: 0.75rem; }
        .back-btn { background: rgba(255,255,255,0.2); color: white; padding: 0.6rem 1.2rem; border: none; border-radius: 6px; cursor: pointer; font-size: 0.95rem; transition: all 0.3s; display: flex; align-items: center; gap: 0.5rem; text-decoration: none; }
        .back-btn:hover { background: rgba(255,255,255,0.3); transform: translateY(-2px); }
        
        /* Container */
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 2rem; }
        
        /* Card */
        .card { background: white; border-radius: 12px; box-shadow: 0 2px 15px rgba(0,0,0,0.08); overflow: hidden; margin-bottom: 2rem; }
        .card-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem 2rem; }
        .card-title { font-size: 1.5rem; font-weight: 600; display: flex; align-items: center; gap: 0.75rem; }
        .card-body { padding: 2rem; }
        
        /* Form */
        .form-group { margin-bottom: 1.5rem; }
        .form-label { display: block; font-weight: 600; margin-bottom: 0.5rem; color: #495057; }
        .form-label.required::after { content: ' *'; color: #dc3545; }
        .form-control { width: 100%; padding: 0.75rem 1rem; border: 2px solid #dee2e6; border-radius: 6px; font-size: 1rem; transition: all 0.3s; font-family: inherit; }
        .form-control:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        textarea.form-control { min-height: 120px; resize: vertical; }
        .form-text { font-size: 0.875rem; color: #6c757d; margin-top: 0.25rem; }
        
        /* File Upload */
        .file-upload { position: relative; overflow: hidden; border: 2px dashed #dee2e6; border-radius: 6px; padding: 2rem; text-align: center; transition: all 0.3s; cursor: pointer; }
        .file-upload:hover { border-color: #667eea; background: #f8f9fa; }
        .file-upload input[type="file"] { position: absolute; left: -9999px; }
        .file-upload-label { cursor: pointer; }
        .file-upload-icon { font-size: 3rem; color: #667eea; margin-bottom: 1rem; }
        .file-preview { margin-top: 1rem; }
        .file-preview img { max-width: 300px; max-height: 200px; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        
        /* Categories Grid */
        .categories-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; }
        .category-checkbox { display: flex; align-items: center; padding: 1rem; border: 2px solid #dee2e6; border-radius: 6px; cursor: pointer; transition: all 0.3s; }
        .category-checkbox:hover { border-color: #667eea; background: #f8f9fa; }
        .category-checkbox input[type="checkbox"] { margin-right: 0.75rem; width: 20px; height: 20px; cursor: pointer; }
        .category-checkbox.checked { border-color: #667eea; background: #f0f4ff; }
        
        /* Dynamic Fields */
        .dynamic-section { border: 2px solid #e9ecef; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; background: #f8f9fa; }
        .dynamic-section-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: #495057; display: flex; align-items: center; gap: 0.5rem; }
        .dynamic-item { background: white; border: 1px solid #dee2e6; border-radius: 6px; padding: 1.5rem; margin-bottom: 1rem; position: relative; }
        .dynamic-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .dynamic-item-title { font-weight: 600; color: #667eea; }
        .remove-btn { background: #dc3545; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.875rem; transition: all 0.3s; display: flex; align-items: center; gap: 0.5rem; }
        .remove-btn:hover { background: #c82333; }
        
        /* Buttons */
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; transition: all 0.3s; display: inline-flex; align-items: center; gap: 0.5rem; text-decoration: none; font-weight: 500; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        
        .form-actions { display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem; padding-top: 2rem; border-top: 2px solid #e9ecef; }
        
        /* Alert */
        .alert { padding: 1rem 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem; }
        .alert-error { background: #f8d7da; color: #721c24; border-left: 4px solid #dc3545; }
        
        /* Icon Picker */
        .icon-picker { display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 0.5rem; max-height: 300px; overflow-y: auto; padding: 1rem; border: 2px solid #dee2e6; border-radius: 6px; background: white; }
        .icon-option { padding: 0.75rem; text-align: center; cursor: pointer; border-radius: 4px; transition: all 0.3s; font-size: 1.5rem; }
        .icon-option:hover { background: #f8f9fa; transform: scale(1.1); }
        .icon-option.selected { background: #667eea; color: white; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 0 1rem; }
            .categories-grid { grid-template-columns: 1fr; }
            .form-actions { flex-direction: column; }
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <div class="header-content">
            <h1 class="header-title">
                <i class="fas fa-plus-circle"></i>
                Create New Case Study
            </h1>
            <a href="{{ route('admin.case-studies.index') }}" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                Back to List
            </a>
        </div>
    </header>

    <div class="container">
        @if($errors->any())
            <div class="alert alert-error">
                <i class="fas fa-exclamation-circle"></i>
                <div>
                    <strong>Please fix the following errors:</strong>
                    <ul style="margin: 0.5rem 0 0 1.5rem;">
                        @foreach($errors->all() as $error)
                            <li>{{ $error }}</li>
                        @endforeach
                    </ul>
                </div>
            </div>
        @endif

        <form method="POST" action="{{ route('admin.case-studies.store') }}" enctype="multipart/form-data">
            @csrf

            <!-- Basic Information -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-info-circle"></i>
                        Basic Information
                    </h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label required">Title</label>
                        <input type="text" name="title" class="form-control" value="{{ old('title') }}" required>
                        <small class="form-text">Enter a compelling case study title</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Description</label>
                        <textarea name="description" class="form-control" required>{{ old('description') }}</textarea>
                        <small class="form-text">Brief overview of the case study</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Featured Image</label>
                        <div class="file-upload" onclick="document.getElementById('imageInput').click()">
                            <label class="file-upload-label">
                                <div class="file-upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <p><strong>Click to upload</strong> or drag and drop</p>
                                <small class="form-text">JPG, PNG or WEBP (MAX. 2MB)</small>
                            </label>
                            <input type="file" id="imageInput" name="image" accept="image/jpeg,image/png,image/jpg,image/webp" required onchange="previewImage(this)">
                            <div class="file-preview" id="imagePreview"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Search Keywords</label>
                        <input type="text" name="search_keywords" class="form-control" value="{{ old('search_keywords') }}">
                        <small class="form-text">Comma-separated keywords for search optimization</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Project Date</label>
                        <input type="text" name="project_date" class="form-control" value="{{ old('project_date') }}" placeholder="e.g., Q1 2024, January 2024">
                        <small class="form-text">Optional project timeline or date</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Display Order</label>
                        <input type="number" name="display_order" class="form-control" value="{{ old('display_order', 0) }}" min="0">
                        <small class="form-text">Lower numbers appear first (0 = default)</small>
                    </div>
                </div>
            </div>

            <!-- Categories -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-tags"></i>
                        Categories
                    </h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label required">Select Categories</label>
                        <div class="categories-grid">
                            @foreach($categories as $category)
                                <label class="category-checkbox">
                                    <input type="checkbox" name="categories[]" value="{{ $category->id }}" 
                                           {{ in_array($category->id, old('categories', [])) ? 'checked' : '' }}
                                           onchange="this.parentElement.classList.toggle('checked', this.checked)">
                                    <span>
                                        <i class="{{ $category->icon }}" style="margin-right: 0.5rem; color: #667eea;"></i>
                                        {{ $category->name }}
                                    </span>
                                </label>
                            @endforeach
                        </div>
                        <small class="form-text">Select at least one category</small>
                    </div>
                </div>
            </div>

            <!-- Status & Settings -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-cog"></i>
                        Status & Settings
                    </h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label required">Status</label>
                        <select name="status" class="form-control" required>
                            <option value="published" {{ old('status') == 'published' ? 'selected' : '' }}>Published</option>
                            <option value="draft" {{ old('status') == 'draft' ? 'selected' : '' }}>Draft</option>
                        </select>
                        <small class="form-text">Only published case studies appear on the frontend</small>
                    </div>

                    <div class="form-group">
                        <label class="category-checkbox">
                            <input type="checkbox" name="is_featured" value="1" {{ old('is_featured') ? 'checked' : '' }}>
                            <span>
                                <i class="fas fa-star" style="color: #ffc107; margin-right: 0.5rem;"></i>
                                <strong>Mark as Featured</strong>
                            </span>
                        </label>
                        <small class="form-text" style="margin-left: 2rem;">Featured case studies are highlighted</small>
                    </div>
                </div>
            </div>

            <!-- Content Sections -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-file-alt"></i>
                        Content Sections
                    </h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">Challenge</label>
                        <textarea name="challenge" class="form-control">{{ old('challenge') }}</textarea>
                        <small class="form-text">Describe the problem or challenge faced</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Solution</label>
                        <textarea name="solution" class="form-control">{{ old('solution') }}</textarea>
                        <small class="form-text">Explain how the problem was solved</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Results</label>
                        <textarea name="results" class="form-control">{{ old('results') }}</textarea>
                        <small class="form-text">Highlight the outcomes and impact</small>
                    </div>
                </div>
            </div>

            <!-- Technologies -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-code"></i>
                        Technologies Used
                    </h2>
                </div>
                <div class="card-body">
                    <div class="dynamic-section">
                        <div class="dynamic-section-title">
                            <i class="fas fa-layer-group"></i>
                            Technology Stack
                        </div>
                        <div id="technologiesContainer"></div>
                        <button type="button" class="btn btn-success" onclick="addTechnology()">
                            <i class="fas fa-plus"></i>
                            Add Technology
                        </button>
                    </div>
                </div>
            </div>

            <!-- Timeline -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-clock"></i>
                        Project Timeline
                    </h2>
                </div>
                <div class="card-body">
                    <div class="dynamic-section">
                        <div class="dynamic-section-title">
                            <i class="fas fa-stream"></i>
                            Timeline Phases
                        </div>
                        <div id="timelineContainer"></div>
                        <button type="button" class="btn btn-success" onclick="addTimeline()">
                            <i class="fas fa-plus"></i>
                            Add Timeline Phase
                        </button>
                    </div>
                </div>
            </div>

            <!-- Metrics -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-chart-line"></i>
                        Results Metrics
                    </h2>
                </div>
                <div class="card-body">
                    <div class="dynamic-section">
                        <div class="dynamic-section-title">
                            <i class="fas fa-tachometer-alt"></i>
                            Key Metrics
                        </div>
                        <div id="metricsContainer"></div>
                        <button type="button" class="btn btn-success" onclick="addMetric()">
                            <i class="fas fa-plus"></i>
                            Add Metric
                        </button>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="card">
                <div class="card-body">
                    <div class="form-actions">
                        <a href="{{ route('admin.case-studies.index') }}" class="btn btn-secondary">
                            <i class="fas fa-times"></i>
                            Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Create Case Study
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script>
        // Image Preview
        function previewImage(input) {
            const preview = document.getElementById('imagePreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Technology Management
        let techCount = 0;
        function addTechnology() {
            const container = document.getElementById('technologiesContainer');
            const html = `
                <div class="dynamic-item" id="tech-${techCount}">
                    <div class="dynamic-item-header">
                        <span class="dynamic-item-title">Technology #${techCount + 1}</span>
                        <button type="button" class="remove-btn" onclick="removeElement('tech-${techCount}')">
                            <i class="fas fa-trash"></i> Remove
                        </button>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Technology Name</label>
                        <input type="text" name="technologies[${techCount}][name]" class="form-control" placeholder="e.g., AWS EKS, Docker, Terraform" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">FontAwesome Icon Class</label>
                        <input type="text" name="technologies[${techCount}][icon]" class="form-control" placeholder="e.g., fab fa-aws, fas fa-database" required>
                        <small class="form-text">Find icons at <a href="https://fontawesome.com/icons" target="_blank">fontawesome.com/icons</a></small>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
            techCount++;
        }

        // Timeline Management
        let timelineCount = 0;
        function addTimeline() {
            const container = document.getElementById('timelineContainer');
            const html = `
                <div class="dynamic-item" id="timeline-${timelineCount}">
                    <div class="dynamic-item-header">
                        <span class="dynamic-item-title">Phase #${timelineCount + 1}</span>
                        <button type="button" class="remove-btn" onclick="removeElement('timeline-${timelineCount}')">
                            <i class="fas fa-trash"></i> Remove
                        </button>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Date/Phase</label>
                        <input type="text" name="timeline[${timelineCount}][date]" class="form-control" placeholder="e.g., W1-2, Phase 1, Q1 2024" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Title</label>
                        <input type="text" name="timeline[${timelineCount}][title]" class="form-control" placeholder="e.g., Discovery & Planning" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Description</label>
                        <textarea name="timeline[${timelineCount}][description]" class="form-control" placeholder="Brief description of this phase" required></textarea>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
            timelineCount++;
        }

        // Metrics Management
        let metricCount = 0;
        function addMetric() {
            const container = document.getElementById('metricsContainer');
            const html = `
                <div class="dynamic-item" id="metric-${metricCount}">
                    <div class="dynamic-item-header">
                        <span class="dynamic-item-title">Metric #${metricCount + 1}</span>
                        <button type="button" class="remove-btn" onclick="removeElement('metric-${metricCount}')">
                            <i class="fas fa-trash"></i> Remove
                        </button>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Number/Value</label>
                        <input type="text" name="metrics[${metricCount}][number]" class="form-control" placeholder="e.g., 99.9%, 50%, 24/7" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Label</label>
                        <input type="text" name="metrics[${metricCount}][label]" class="form-control" placeholder="e.g., Uptime, Cost Reduction, Support" required>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
            metricCount++;
        }

        // Remove Element
        function removeElement(id) {
            const element = document.getElementById(id);
            if (element) {
                element.remove();
            }
        }

        // Initialize checked categories
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.category-checkbox input[type="checkbox"]:checked').forEach(function(checkbox) {
                checkbox.parentElement.classList.add('checked');
            });
        });
    </script>
</body>
</html>
