<?php

namespace App\Http\Controllers;

use App\Models\Blog;

class BlogController extends Controller
{
    public function index()
    {
        $blogs = Blog::where('status', 'published')
            ->latest('published_at')
            ->paginate(6);
        
        return view('blogs.index', compact('blogs'));
    }

    public function show($slug)
    {
        // Get the current blog post
        $blog = Blog::where('slug', $slug)
            ->where('status', 'published')
            ->firstOrFail();
        
        // Get previous post (older post based on published_at)
        $previousPost = Blog::where('status', 'published')
            ->where('published_at', '<', $blog->published_at)
            ->orderBy('published_at', 'desc')
            ->first();
        
        // Get next post (newer post based on published_at)
        $nextPost = Blog::where('status', 'published')
            ->where('published_at', '>', $blog->published_at)
            ->orderBy('published_at', 'asc')
            ->first();
        
        // Get related posts from the same category (excluding current blog)
        $relatedPosts = Blog::where('status', 'published')
            ->where('category', $blog->category)
            ->where('id', '!=', $blog->id)
            ->orderBy('published_at', 'desc')
            ->limit(3)
            ->get();
        
        return view('blogs.show', compact('blog', 'previousPost', 'nextPost', 'relatedPosts'));
    }
}
